---
const pathname = Astro.url.pathname;

const parts = pathname.split('/');
const currentLang = parts[1];
const otherLang = currentLang === 'pt' ? 'en' : 'pt';

let targetHref = `/${otherLang}`;

// Se for notícia individual
if (parts[2] === 'noticias' && parts[3]) {
  const slug = parts[3];

  // @ts-ignore - Astro-specific dynamic import
  const allNews = import.meta.glob('/src/content/noticias/**/*.md', { eager: true });

  const found = Object.keys(allNews).some(
    (path) => path.includes(`/noticias/${otherLang}/${slug}.md`)
  );

  targetHref = found
    ? `/${otherLang}/noticias/${slug}`
    : `/${otherLang}/noticias`;

} else {
  const rest = pathname.replace(/^\/(pt|en)/, '');
  targetHref = `/${otherLang}${rest}`;
}
---

<a href={targetHref} aria-label="Trocar idioma" title="Trocar idioma">🌐</a>