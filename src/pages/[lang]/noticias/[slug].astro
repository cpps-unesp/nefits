---
import { getCollection } from "astro:content";
import Layout from "../../../layouts/Layout.astro";
import Intro from "../../../components/Intro.astro";
import Fapesp from "../../../components/Fapesp.astro";
import Rodape from "../../../components/Rodape.astro";
import { useTranslations } from "../../../i18n/translations";

export async function getStaticPaths() {
  const noticias = await getCollection("noticias");

  return noticias.map((noticia) => ({
    params: {
      lang: noticia.data.lang,  // Cada notícia define seu idioma
      slug: noticia.slug,
    },
  }));
}

const { lang, slug } = Astro.params;
const t = useTranslations(lang);

// Pegando as notícias
const noticias = await getCollection("noticias");

// Procurar a notícia correta baseada em slug e idioma
const noticia = noticias.find(
  (n) => n.data.slug === slug && n.data.lang === lang
);


// Descobre se existe a versão no outro idioma
const outroLang = lang === "pt" ? "en" : "pt";

const noticiaOutroIdioma = noticias.find(
  (n) => n.data.slug === slug && n.data.lang === outroLang
);

if (!noticia) {
  throw new Error(`Notícia não encontrada para slug: ${slug} e idioma: ${lang}`);
}
---

<Layout lang={lang}>
  <Intro lang={lang} t={t} />

  <main class="max-w-5xl mx-auto p-8">
    <div class="text-center mb-8">
      <h1 class="text-[2rem] font-bold text-[#ab090e] mb-4">
        {noticia.data.title}
      </h1>
      <img src={noticia.data.imagem} alt={noticia.data.title} class="mx-auto mb-6 rounded-lg shadow-md max-h-[400px] object-contain" />
    </div>

    <article class="prose prose-neutral text-[#656565] font-light space-y-6">
      {noticia.body}
    </article>
    {noticiaOutroIdioma && (
        <div class="text-center mt-8">
          <a 
            href={`/${outroLang}/noticias/${slug}`}
            class="inline-block px-6 py-3 bg-gray-200 hover:bg-gray-300 text-[#656565] rounded font-bold text-sm"
          >
            {outroLang === "pt" ? "Ver em Português" : "View in English"}
          </a>
        </div>
      )}

    <div class="text-center mt-12">
      <a href={`/${lang}/noticias`} class="inline-block px-6 py-3 bg-[#ab090e] hover:bg-[#90070b] text-white rounded font-bold text-sm">
        {t("4.voltarNoticias")}
      </a>
    </div>
  </main>

  <Fapesp lang={lang} t={t} />
  <Rodape lang={lang} t={t} />
</Layout>
